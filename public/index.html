<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fashion Boutique - Professional Online Shopping</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #1a1a1a; }
    .header { background: linear-gradient(135deg, #2d3436 0%, #000000 100%); color: white; padding: 1rem 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
    .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 1.8rem; font-weight: 800; color: white; text-decoration: none; cursor: pointer; }
    .nav-menu { display: flex; list-style: none; gap: 2rem; align-items: center; }
    .nav-menu a { color: white; text-decoration: none; font-weight: 500; cursor: pointer; }
    .cart-icon { position: relative; font-size: 1.5rem; cursor: pointer; user-select: none; }
    .cart-count { position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; }
    .hero { background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23667eea" width="1200" height="600"/></svg>'); background-size: cover; color: white; padding: 6rem 2rem 4rem; text-align: center; }
    .hero h1 { font-size: 3.5rem; margin-bottom: 1rem; font-weight: 800; }
    .filter-section { background: #f8f9fa; padding: 1.5rem; border-bottom: 2px solid #ddd; }
    .filter-container { max-width: 1400px; margin: 0 auto; display: flex; gap: 1rem; flex-wrap: wrap; }
    .filter-btn { padding: 0.7rem 1.3rem; border: 2px solid #2d3436; background: white; color: #2d3436; border-radius: 25px; cursor: pointer; font-weight: 600; }
    .filter-btn.active { background: #2d3436; color: white; }
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; max-width: 1400px; margin: 3rem auto; padding: 0 2rem; }
    .product-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: all 0.3s; }
    .product-card:hover { transform: translateY(-10px); }
    .product-image { width: 100%; height: 320px; overflow: hidden; background:#f1f1f1; }
    .product-image img { width: 100%; height: 100%; object-fit: cover; }
    .product-details { padding: 1.5rem; }
    .product-category { font-size: 0.85rem; color: #636e72; text-transform: uppercase; font-weight: 600; }
    .product-name { font-size: 1.2rem; font-weight: 700; margin: 0.5rem 0; }
    .product-price { font-size: 1.4rem; font-weight: 800; color: #e74c3c; margin-bottom: 1rem; }
    .add-to-cart-btn { width: 100%; padding: 0.9rem; background: #2d3436; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; }
    .hidden { display:none !important; }
    .admin-panel { max-width:800px; margin:3rem auto; padding:2rem; background:white; border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,0.1); }
    .image-upload-area { border:3px dashed #ddd; border-radius:12px; padding:2rem; text-align:center; cursor:pointer; }
    .image-preview { max-width:100%; max-height:300px; margin-top:1rem; border-radius:8px; }
    .product-list { margin-top:2rem; }
    .product-item { background:white; padding:1.5rem; border-radius:10px; margin-bottom:1rem; box-shadow:0 3px 10px rgba(0,0,0,0.1); display:flex; gap:1rem; align-items:center; }
    .product-item-image { width:100px; height:100px; border-radius:8px; overflow:hidden; background:#f1f1f1; }
    .product-item-image img { width:100%; height:100%; object-fit:cover; }
    .product-item-details { flex:1; }
    .btn-primary { padding: 0.9rem 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; border:none; border-radius:8px; font-weight:700; cursor:pointer; }
    .btn-danger { padding: 0.7rem 1rem; background:#e74c3c; color:white; border:none; border-radius:8px; font-weight:700; cursor:pointer; }
    .loading { text-align:center; padding:3rem; font-size:1.2rem; color:#636e72; }
    @media (max-width:768px){ .hero h1{font-size:2.3rem;} }
  </style>
</head>

<body>
  <header class="header">
    <nav class="nav-container">
      <a class="logo" onclick="showShop()">ðŸ‘— Fashion Boutique</a>
      <ul class="nav-menu">
        <li><a onclick="showShop()">Shop</a></li>
        <li><a onclick="openAdmin()">Admin</a></li>
        <li>
          <div class="cart-icon" onclick="alert('Cart demo. Add checkout later.')">
            ðŸ›’ <span class="cart-count" id="cartCount">0</span>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <h1>Discover Your Perfect Style</h1>
    <p>Premium Fashion Collection - Cultural & Modern Clothing</p>
  </section>

  <div class="filter-section" id="shopSection">
    <div class="filter-container">
      <button class="filter-btn active" onclick="filterProducts('all', this)">All</button>
      <button class="filter-btn" onclick="filterProducts('cultural', this)">Cultural</button>
      <button class="filter-btn" onclick="filterProducts('tshirt', this)">T-Shirts</button>
      <button class="filter-btn" onclick="filterProducts('men', this)">Men</button>
      <button class="filter-btn" onclick="filterProducts('women', this)">Women</button>
    </div>
  </div>

  <div id="loadingProducts" class="loading">Loading products...</div>
  <div class="products-grid" id="productsGrid"></div>

  <!-- ADMIN -->
  <div id="adminSection" class="hidden">
    <div class="admin-panel">
      <h2 style="margin-bottom: 0.75rem;">Admin</h2>

      <div style="display:flex;gap:0.75rem;flex-wrap:wrap;margin-bottom:1.5rem;">
        <button class="btn-primary" onclick="setAdminKey()">Set Admin Key</button>
        <button class="btn-danger" onclick="logoutAdmin()">Logout</button>
      </div>

      <h3 style="margin-bottom:1rem;">Add New Product</h3>
      <form id="productForm">
        <div class="image-upload-area" onclick="document.getElementById('imageInput').click()">
          <p>ðŸ“· Upload Image</p>
          <input type="file" id="imageInput" accept="image/*" style="display:none;">
          <img id="imagePreview" class="image-preview hidden" alt="Preview">
        </div>

        <div style="margin-top:1rem;">
          <label><b>Product Name</b></label>
          <input id="productName" required style="width:100%;padding:0.8rem;border:2px solid #ddd;border-radius:8px;">
        </div>

        <div style="margin-top:1rem;">
          <label><b>Description</b></label>
          <textarea id="productDescription" rows="3" style="width:100%;padding:0.8rem;border:2px solid #ddd;border-radius:8px;"></textarea>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem;">
          <div>
            <label><b>Category</b></label>
            <select id="productCategory" required style="width:100%;padding:0.8rem;border:2px solid #ddd;border-radius:8px;">
              <option value="cultural">Cultural</option>
              <option value="tshirt">T-Shirt</option>
              <option value="dress">Dress</option>
            </select>
          </div>
          <div>
            <label><b>Gender</b></label>
            <select id="productGender" required style="width:100%;padding:0.8rem;border:2px solid #ddd;border-radius:8px;">
              <option value="men">Men</option>
              <option value="women">Women</option>
              <option value="kids">Kids</option>
            </select>
          </div>
        </div>

        <div style="margin-top:1rem;">
          <label><b>Price (ETB)</b></label>
          <input type="number" id="productPrice" step="0.01" required style="width:100%;padding:0.8rem;border:2px solid #ddd;border-radius:8px;">
        </div>

        <button class="btn-primary" type="submit" style="width:100%;margin-top:1.2rem;">Add Product</button>
      </form>

      <h3 style="margin-top:2rem;margin-bottom:1rem;">Manage Products</h3>
      <div class="product-list" id="productList"></div>
    </div>
  </div>

  <script>
    // âœ… YOUR RENDER BACKEND
    const API_BASE = "https://fashion-2tif.onrender.com";

    let products = [];
    let currentFilter = "all";
    let currentImage = null;

    const ADMIN_KEY_STORAGE = "FASHION_ADMIN_KEY";
    const getAdminKey = () => localStorage.getItem(ADMIN_KEY_STORAGE) || "";

    function setAdminKey() {
      const k = prompt("Enter ADMIN_API_KEY (from Render env vars):");
      if (!k) return;
      localStorage.setItem(ADMIN_KEY_STORAGE, k.trim());
      alert("Admin key saved on this browser.");
    }
    function logoutAdmin() {
      localStorage.removeItem(ADMIN_KEY_STORAGE);
      alert("Admin key removed.");
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function formatMoney(n){ return (Number(n)||0).toFixed(0); }

    async function loadProducts(){
      const loading = document.getElementById("loadingProducts");
      try {
        const res = await fetch(API_BASE + "/api/products", { cache: "no-store" });
        const data = await res.json();
        products = Array.isArray(data) ? data : [];
        loading.classList.add("hidden");
        renderProducts();
      } catch (err) {
        console.error(err);
        loading.innerHTML = '<p style="color:#e74c3c;">Failed to load products from backend.</p>';
      }
    }

    function filterProducts(category, btnEl){
      currentFilter = category;
      document.querySelectorAll(".filter-btn").forEach(btn => btn.classList.remove("active"));
      if (btnEl) btnEl.classList.add("active");
      renderProducts();
    }

    function renderProducts(){
      const grid = document.getElementById("productsGrid");
      const filtered = (currentFilter === "all")
        ? products
        : products.filter(p => p.category === currentFilter || p.gender === currentFilter);

      if (!filtered.length) {
        grid.innerHTML = `<div style="padding:1rem;color:#636e72;">No products found.</div>`;
        return;
      }

      grid.innerHTML = filtered.map(p => `
        <div class="product-card">
          <div class="product-image">
            <img src="${p.image || ''}" alt="${escapeHtml(p.name || 'Product')}">
          </div>
          <div class="product-details">
            <div class="product-category">${escapeHtml(p.category || '')} â€¢ ${escapeHtml(p.gender || '')}</div>
            <div class="product-name">${escapeHtml(p.name || '')}</div>
            ${p.description ? `<p style="font-size:0.9rem;color:#636e72;margin:0.5rem 0;">${escapeHtml(p.description)}</p>` : ""}
            <div class="product-price">${formatMoney(p.price)} ETB</div>
            <button class="add-to-cart-btn" onclick="alert('Cart demo')">Add to Cart</button>
          </div>
        </div>
      `).join("");
    }

    function openAdmin(){
      document.getElementById("adminSection").classList.remove("hidden");
      renderProductList();
      window.scrollTo({ top: document.getElementById("adminSection").offsetTop, behavior: "smooth" });
    }
    function showShop(){
      document.getElementById("adminSection").classList.add("hidden");
      document.getElementById("shopSection").scrollIntoView({ behavior: "smooth" });
    }

    function renderProductList(){
      const list = document.getElementById("productList");
      if (!products.length) {
        list.innerHTML = '<p style="color:#636e72;padding:1rem;">No products yet.</p>';
        return;
      }

      list.innerHTML = products.map(p => `
        <div class="product-item">
          <div class="product-item-image">
            <img src="${p.image || ''}" alt="${escapeHtml(p.name || '')}">
          </div>
          <div class="product-item-details">
            <h3>${escapeHtml(p.name || '')}</h3>
            <p><b>Category:</b> ${escapeHtml(p.category || '')} | <b>Gender:</b> ${escapeHtml(p.gender || '')}</p>
            <p><b>Price:</b> ${formatMoney(p.price)} ETB</p>
          </div>
          <div>
            <button class="btn-danger" onclick="deleteProduct('${p.id}')">Delete</button>
          </div>
        </div>
      `).join("");
    }

    async function adminFetch(url, options = {}) {
      const adminKey = getAdminKey();
      if (!adminKey) {
        alert("Admin key not set. Click 'Set Admin Key' first.");
        throw new Error("Missing admin key");
      }
      const headers = { ...(options.headers || {}), "x-admin-key": adminKey, "Content-Type": "application/json" };
      return fetch(url, { ...options, headers });
    }

    async function deleteProduct(id){
      if (!confirm("Delete this product?")) return;
      try {
        const res = await adminFetch(API_BASE + "/api/products/" + encodeURIComponent(id), { method: "DELETE" });
        const data = await res.json();
        if (!res.ok) throw new Error(data?.error || "Delete failed");
        await loadProducts();
        renderProductList();
        alert("Deleted!");
      } catch (e) {
        alert("Delete error: " + e.message);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("imageInput").addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          currentImage = ev.target.result;
          const img = document.getElementById("imagePreview");
          img.src = currentImage;
          img.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      });

      document.getElementById("productForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        if (!currentImage) return alert("Please upload an image.");

        const newProduct = {
          name: document.getElementById("productName").value.trim(),
          description: document.getElementById("productDescription").value.trim(),
          category: document.getElementById("productCategory").value,
          gender: document.getElementById("productGender").value,
          price: Number(document.getElementById("productPrice").value) || 0,
          image: currentImage
        };

        try {
          const res = await adminFetch(API_BASE + "/api/products", {
            method: "POST",
            body: JSON.stringify({ product: newProduct })
          });

          const data = await res.json();
          if (!res.ok) throw new Error(data?.error || "Add failed");

          alert("Product added!");
          e.target.reset();
          document.getElementById("imagePreview").classList.add("hidden");
          currentImage = null;

          await loadProducts();
          renderProductList();
        } catch (err) {
          alert("Add error: " + err.message);
        }
      });

      loadProducts();
    });
  </script>
</body>
</html>
